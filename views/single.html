{% extends 'layout.html' %}
{% block content %}
<wired-card class="entire_single" elevation="5" >
    <h3 class="alone">싱글 게임</h3>
    <div class="hint">
        <textarea class="first_line container" disabled elevation="5"></textarea>
        <textarea class="first_line container" disabled elevation="5"></textarea>
    </div>

    <div class="hint">
        <textarea class="first_line container" disabled elevation="5"></textarea>
        <textarea class="first_line container" disabled elevation="5"></textarea>
    </div>

    <div class="who">
        <wired-card class="second_line" elevation="5"><span>누구일까요?</span></wired-card>
        <wired-button elevation="3">확인</wired-button>
        <wired-input type="text" name="title" placeholder="챔피언 입력"> 
    </div>

    <div class="exit">
        <wired-dialog-demo>
            <wired-button elevation="3" id="lobby">로비로 돌아가기</wired-button>
            <wired-dialog class="hidden" open>
                <div id="appear" >
                    <p>정말 나가실건가요?</p>
                    <wired-button id="go_out" onclick="location.href='http://localhost:3000/lobby'">나가기</wired-button>
                    <wired-button id="leave">계속 하기</wired-button>
                </div>
                
            </wired-dialog>
        </wired-dialog-demo>
    </div>
</wired-card>
{% endblock %}
{% block script %}
<script>
	console.log(sessionStorage.getItem('userName'));
	const socket = io.connect('http://localhost:3000/single', {
		path: '/socket.io',
	});

	// 문제 가져옴
	sessionStorage.setItem('turnCount', 0);
	sessionStorage.setItem('correctedCount', 0);
	socket.emit('make');
	socket.on('get', function(quizSet) { 
		let data = quizSet.quizSet1;
		const hintcard = document.querySelectorAll('.hint textarea');
		for(let i=0; i< 4;i++){
			hintcard[i].innerHTML = data[i].content;
		}
		var tc = sessionStorage.getItem('turnCount');
		sessionStorage.setItem('turnCount', parseInt(tc)+parseInt(1)); //문제1~10
  	});

	// 확인 버튼
	function addConfirmEvent(e) {
		const insertedAnswer = document.querySelector('wired-input').value;
		console.log('확인버튼 누름');

		socket.emit('answer', insertedAnswer);
		socket.on('correction', function(data) {
			let tc = sessionStorage.getItem('turnCount');
			if(tc <= 10) {
				console.log(`문제 푸는 중..`);
				if( data === 'right'){
					cc = sessionStorage.getItem('correctedCount');
					sessionStorage.setItem('correctedCount', parseInt(cc)+parseInt(1));
				}
				alert(`채점 결과: ${data}\n${tc}중 ${sessionStorage.getItem('correctedCount')}맞춤!`);
				socket.off('correction'); //소켓이벤트 중복 실행방지. 별도로 닫아주지않을 때 발생
				socket.emit('make');
				if(tc == 10){
					alert('10문제 다 풀었다! finish이벤트 실행');
					let correctedCount = sessionStorage.getItem('correctedCount');
					result = {}
					result.score = correctedCount;
					result.time = 10;
					result.
					socket.off('correction'); //소켓이벤트 중복 실행방지. 별도로 닫아주지않을 때 발생
					socket.emit('finish', result);
				}
			}
		})
	}
	const btn = document.querySelector('wired-button');
	btn.addEventListener('click', addConfirmEvent);	

    const button = document.getElementById("lobby");
    const dialog = document.querySelector("wired-dialog");
    const leave = document.getElementById("leave");
    const go_out = document.getElementById("go_out");

    button.addEventListener("click" , () => {
        dialog.classList.remove("hidden");
    });

    leave.addEventListener("click" , () => {
        dialog.classList.add("hidden");
    });
</script>
{% endblock %}